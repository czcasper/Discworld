<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:p="http://primefaces.org/ui">
    <h:head>
        <title>My first X3DOM page</title> 			
        <!--<script type='text/javascript' src='http://www.x3dom.org/download/x3dom.js'></script>--> 
        <script type='text/javascript' src='x3dom.js'></script> 

        <script type="text/javascript">
            //<![CDATA[
            var parser = new DOMParser();
            function test() {
                addObject('<transforms><transform translation="0 0 0"><shape><appearance><material diffuseColor="0 0 1"/></appearance><box size="1,1,1"/></shape></transform><transform translation="1 0 0"><shape><appearance><material diffuseColor="0 0 1"/></appearance><box size="1,1,1"/></shape></transform></transforms>');
            }
            ;

            function addObject(def) {
                var doc = parser.parseFromString(def, "text/xml");
                var ot = document.getElementById('root');
                var rootName = doc.firstChild.nodeName.toUpperCase();
                if (rootName === "TRANSFORMS") {
                    var transforms = doc.firstChild;
                    var childs = transforms.firstChild;
                    while (childs !== null) {
                        var addopted = document.adoptNode(childs);
                        ot.appendChild(addopted);
                        childs = transforms.firstChild;
                    }
                } else if (rootName === "TRANSFORM") {
                    var addopted = document.adoptNode(doc.firstChild);
                    ot.appendChild(addopted);
                }
                return false;
            }
            ;

            function removeNode()
            {
                var ot = document.getElementById('root');
                for (var i = 0; i < ot.childNodes.length; i++) {
                    // check if we have a real X3DOM Node; not just e.g. a Text-tag
                    if (ot.childNodes[i].nodeType === Node.ELEMENT_NODE) {
                        ot.removeChild(ot.childNodes[i]);
                        break;
                    }
                }

                return false;
            }
            ;

            //]]>
        </script>
        <link rel='stylesheet' type='text/css' href='http://www.x3dom.org/download/x3dom.css'></link> 
    </h:head>
    <h:body>
        Hello from Facelets
        <br />
        <h:link outcome="welcomePrimefaces" value="Primefaces welcome page" />
        <h:form id="form">
            <p:remoteCommand name="onload" action="#{cubeManager.initializeX3DomScene}" autoRun="true" />
            <p:layout fullPage="true">
                <p:layoutUnit position="north" size="100" resizable="true" closable="true" collapsible="true">
                    Header
                </p:layoutUnit>
                <p:layoutUnit position="west" size="175" header="Left" collapsible="true">
                    <p:menu>
                        <p:submenu label="Resources">
                            <p:menuitem value="Create Cube" onclick="PF('cubeCreationDialog').show()" />
                            <p:menuitem value="Documentation" url="http://www.primefaces.org/documentation.html" />
                            <p:menuitem value="Forum" url="http://forum.primefaces.org/" />
                            <p:menuitem value="Themes" url="http://www.primefaces.org/themes.html" />
                        </p:submenu>
                    </p:menu>
                    <input type="button" value="Test JS" onclick="window.test();" />
                </p:layoutUnit>

                <p:layoutUnit position="center">
                    <x3d width='600px' height='400px'> 
                        <scene>
                            <transform id="root" translation="0 0 0"></transform>
                        </scene> 
                    </x3d>
                </p:layoutUnit>

            </p:layout>

            <p:dialog widgetVar="cubeCreationDialog" modal="true" showEffect="fade" hideEffect="fade" resizable="false" >
                <h:panelGrid columns="2" cellpadding="5">
                    <h:outputLabel for="xAxis" value="x coordinate:" />
                    <p:inputText id="xAxis" value="#{cubeManager.tmpCube.xAxis}" required="true" label="x coordinate" />
                    <h:outputLabel for="yAxis" value="y coordinate" />
                    <p:inputText id="yAxis" value="#{cubeManager.tmpCube.yAxis}" required="true" label="y coordinate" />
                    <h:outputLabel for="zAxis" value="z coordinate:" />
                    <p:inputText id="zAxis" value="#{cubeManager.tmpCube.zAxis}" required="true" label="z coordinate" />
                    <p:commandButton value="Complete" actionListener="#{cubeManager.createCube}" oncomplete="PF('cubeCreationDialog').hide()"/>
                    <p:commandButton value="Cancel" oncomplete="PF('cubeCreationDialog').hide()" />
                </h:panelGrid>
            </p:dialog>
        </h:form>
        <br />
    </h:body>
</html>

